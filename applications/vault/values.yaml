apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-values
  namespace: flux-system
data:
  values.yaml: |
    global:
      tlsDisable: true

    server:
      resources:
        requests:
          memory: 256Mi
          cpu: 250m
        limits:
          memory: 512Mi
          cpu: 500m

      standalone:
        enabled: true
        config: |
          disable_mlock = true
          ui = true

          listener "tcp" {
            tls_disable = 1
            address = "[::]:8200"
            cluster_address = "[::]:8201"
            telemetry {
              unauthenticated_metrics_access = "true"
            }
          }

          storage "raft" {
            path = "/vault/data"
          }

          service_registration "kubernetes" {}

      uid: 100
      gid: 1000
      securityContext:
        pod:
          runAsNonRoot: true
          runAsUser: 100
          runAsGroup: 1000
          fsGroup: 1000
        container:
          allowPrivilegeEscalation: false

      extraLabels:
        app.kubernetes.io/component: server
        app.kubernetes.io/part-of: vault

      dataStorage:
        enabled: true
        size: 10Gi

      extraInitContainers:
        - name: fix-permissions
          image: busybox:latest
          command: ['sh', '-c', 'chmod -R 777 /vault/data']
          securityContext:
            runAsUser: 0
            runAsNonRoot: false
          volumeMounts:
            - name: data
              mountPath: /vault/data

      volumes:
        - name: tmp
          emptyDir: {}

      volumeMounts:
        - name: tmp
          mountPath: /tmp

    injector:
      enabled: false

    ui:
      enabled: true
